---
title: 微信SaaS小程序
tags: 小程序
categories: 小程序
---

> 即微信环境第三方代开发类型小程序



## 一、简介


为什么会有这个模式的小程序？


SaaS，大家都知道，主要是搭建一个公共平台，然后使用方买来直接使用，不需要开发、不需要自己维护，拎包入住，花钱省力。


那么对于小程序端，也就会有这样的需求了。SaaS提供方负责开发维护小程序，支持各种类型的使用方需求；而SaaS使用方则只需要购买小程序，填充自己的内容，直接使用就可以了！


在微信这里，SaaS提供方称为 “[第三方平台](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Third_party_platform_appid.html)”，以下简称“第三方”；


由第三方托管的小程序，称为“第三方代开发小程序”，以下简称“SaaS小程序”；


第三方在开发阶段，需要有一个“模板小程序”，完成模板开发后，再将模板部署到使用方小程序。


## 二、准备阶段


### 申请平台


这里需要先熟悉两个平台：


- 微信开放平台，是移动应用、微信公众号、小程序、第三方平台等的管理平台。
- 第三方平台，就是来管理SaaS小程序的平台。



创建这两个账号的方法可以直接看 [这里](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/how_to_apply.html)


![第三方平台.png](https://cdn.nlark.com/yuque/0/2021/png/12735713/1615020113548-239cfa5f-eeda-4c7f-ba43-d94f75abb56f.png#align=left&display=inline&height=937&margin=%5Bobject%20Object%5D&name=%E7%AC%AC%E4%B8%89%E6%96%B9%E5%B9%B3%E5%8F%B0.png&originHeight=937&originWidth=1920&size=43936&status=done&style=shadow&width=1920)


### 申请模板小程序


刚刚已提到，SaaS小程序的开发，需要由第三方创建一个小程序作为“模板”，开发完成之后，会将这个模板部署到旗下的小程序。


申请小程序的方法，同 [普通微信小程序](https://mp.weixin.qq.com/wxopen/waregister?action=step1&token=&lang=zh_CN)。


### 绑定模板小程序


模板小程序申请好之后，需要在“微信开放平台 - 第三方平台”绑定该小程序，这样，这个小程序才能真正成为“模板”。


> 这里要注意：模板小程序被绑定后，该小程序的开发权限就已授权给第三方平台，比如开发域名配置、类目设置等等，第三方平台在发布时会覆盖小程序原有的配置。



![绑定小程序.png](https://cdn.nlark.com/yuque/0/2021/png/12735713/1615020769440-86e0880b-0f44-4335-9182-8e07c7730ce0.png#align=left&display=inline&height=937&margin=%5Bobject%20Object%5D&name=%E7%BB%91%E5%AE%9A%E5%B0%8F%E7%A8%8B%E5%BA%8F.png&originHeight=937&originWidth=1910&size=77905&status=done&style=shadow&width=1910)


## 三、开发阶段


> 这里的开发，就特指模板小程序的开发了！



### 创建小程序项目


创建方法和普通微信小程序相同，在开发者工具填入AppID即可（这里的AppID，就是模板小程序的AppID）。


创建成功之后，就可以在 “开发者工具 - 详情 - 基本信息” 中看到该小程序所在的平台名。


> 这里注意：模板小程序一定要成功绑定到第三方平台才可，否则创建项目之后看不到平台信息。



![绑定成功.png](https://cdn.nlark.com/yuque/0/2021/png/12735713/1615021128797-0282eb9d-07a9-49d2-8c7f-dd97d4e644bd.png#align=left&display=inline&height=1040&margin=%5Bobject%20Object%5D&name=%E7%BB%91%E5%AE%9A%E6%88%90%E5%8A%9F.png&originHeight=1040&originWidth=1920&size=100007&status=done&style=shadow&width=1920)


### ext.json


细心的同学可能已经发现了，当我们创建好模板小程序项目后，相比于普通微信小程序，根目录下多了一个 `ext.json` 文件，而且和 `app.json` 文件特别相似。


##### 为什么会有 `ext.json` ？


我们先来思考两个问题，当使用方小程序授权到第三方平台后，开发权限就交给了第三方。那：


- 使用方小程序运行遇到了问题，而第三方又没有开发者权限，该如何模拟联调？
- 使用方小程序需要自定义配置，比如想自定义设置窗口样式、Tabbar等，怎么办？



为解决以上问题，就引入了 `ext.json` （ext：external 外部的）配置文件：


- 通过 `extAppid`，第三方可以在开发者工具切换成使用方小程序。
- 在第三方平台帮助使用方小程序提交审核时，微信服务端会将 `ext.json` 覆盖 `app.json` 中的对应配置，这样模板配置就可以同步到使用方小程序；同时，第三方平台在提交使用方小程序时，也可以自定义设置一个 `ext_json` 字段 ，这个字段的数据格式与前端的 `ext.json` 文件完全相同，修改配置后同样会覆盖 `app.json`，这样就可以实现使用方的自定义需求了。



##### 如何配置 `ext.json` ？


1、特有的配置，重点关注：


- `extEnable`：指定 `ext.json` 是否生效。打开时，将从 `ext.json` 加载配置，`app.json` 不再生效；如果关闭，加载的将是 `app.json`（这也是为什么 `ext.json` 和 `app.json` 会同时存在了）



- `extAppid`：指的就是当前在调试的AppID，比如开发阶段，就是模板小程序；如果是调试线上问题，就可以切换成使用方对应的小程序AppID，而不需要单独设置开发者权限。



- `ext`：这个就是支持前端开发者自定义数据了，然后在业务逻辑中通过 `wx.getExtConfig` 获取到。



2、同 `app.json` 中的配置：


- `pages`
- `subpackages`
- `window`
- `networkTimeout`
- 等



> 由于模板小程序和大多小使用方程序都是新申请的，没有原来的配置，所以这就是为什么这两个文件内容相似度很高了~



##### 特别注意


- `ext.json` 这个文件只是用于开发模板小程序、以及联调同一第三方平台下的使用方小程序，在提交审核后没有这个文件，所以这个文件的配置一定要是正确的~
- 在开发过程中，如果开启 `extEnable`，那么加载的将是 `ext.json`，修改配置需要改的是这个文件，而不是 `app.json`。尤其是变更了路由，开发者工具可能默认会修改 `app.json`，并不会修改 `ext.json`，一定记得同步！否则，上线后就会发现页面路径错误了！切记！
- 在提交微信审核时，`ext.json` 会覆盖 `app.json`，同时，第三方平台也可以通过 `ext_json` 来二次覆盖。
- 提交审核、发布后，线上小程序加载的是被更新后的 `app.json`。



### 页面开发


在页面开发阶段，和普通小程序类似，关注业务即可。


但需要注意：如果修改可信域名配置，需要在“微信开发平台 - 第三方平台”来设置。微信公众平台设置的域名会在平台更新发布后被覆盖。


![域名授权.png](https://cdn.nlark.com/yuque/0/2021/png/12735713/1615022329073-d2b2de29-3eee-4210-a1ca-a500beb5b08b.png#align=left&display=inline&height=937&margin=%5Bobject%20Object%5D&name=%E5%9F%9F%E5%90%8D%E6%8E%88%E6%9D%83.png&originHeight=937&originWidth=1914&size=76487&status=done&style=shadow&width=1914)
![域名覆盖.png](https://cdn.nlark.com/yuque/0/2021/png/12735713/1615022577139-67392c73-699e-4829-8256-a7bec455fd17.png#align=left&display=inline&height=969&margin=%5Bobject%20Object%5D&name=%E5%9F%9F%E5%90%8D%E8%A6%86%E7%9B%96.png&originHeight=969&originWidth=1911&size=62670&status=done&style=shadow&width=1911)
## 四、体验阶段


### 开发预览


同普通微信小程序，直接生成预览二维码，然后微信扫码验证即可。


### 上传开发版到模板库


这里就有不同了~


由于模板小程序已被授权给第三方平台，在开发者工具“上传”代码后，会直接上传到开放平台，不会上传到公众平台。


上传成功之后，可以在“微信开放平台 - 管理中心 - 第三方平台 - 详情 - 开发配置 - 小程序模板库”中找到。


![上传到模板库.png](https://cdn.nlark.com/yuque/0/2021/png/12735713/1615022801316-518e5e49-74d5-4295-bc6d-866865291d0e.png#align=left&display=inline&height=937&margin=%5Bobject%20Object%5D&name=%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%A8%A1%E6%9D%BF%E5%BA%93.png&originHeight=937&originWidth=1913&size=78592&status=done&style=shadow&width=1913)


这里有两个概念：“草稿箱”和“模板库”，都是保存小程序版本的列表。在我们的 `ext.json` 中，有个 `Boolean` 类型的 `directCommit` 字段，指是否直接上传到审核列表中。当设置为 `false` 时，会先上传到草稿箱，然后可以手动添加到模板库；为 `true` 时会直接上传到模板库。


那么，这里的模板可以做什么用？


我们每次在开发者工具上传一份代码时，都会保存到微信服务器。如果是模板小程序，则会同时找到对应的第三方平台，然后生成一条记录（同一个用户的会更新覆盖）。当我们从草稿箱添加到模板库时，就会创建一个模板 `templateID` 。那么，这个模板，其实就是一个版本了，只是都处于待审核阶段。


微信为第三方平台开放了很多api来管理这些模板，那么，第三方就可以根据使用方的需求，选择一个指定的模板部署到使用方小程序。


### 上传模板小程序代码


> 其实，当上传代码到模板库之后，前端有权能做的事情，基本就结束了。接下来的操作，就需要服务端来调用微信接口了。



模板小程序除了模板的作用外，也还是小程序，因此同样可以上传代码到微信服务器、配置体验版、提交审核，发布之后同样可以在微信环境中运行。


如果希望体验模板小程序，则需要先上传该模板小程序代码到微信服务器。具体操作：


- 获取模板库中最新的模板id，或者获取想要上传的模板id
- 设置自定义 `app_json`，注意：`ext.json` 即将覆盖 `app.json`，如果有自定义设置项，还需要使用 `app_json` 来更新！具体会如何覆盖可以看 [这里](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/commit.html)
- 确认无误后，调用接口，上传小程序代码即可



### 配置模板小程序体验版


当模板小程序代码已经上传后，就可以 [获取体验版二维码](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/get_qrcode.html) 来验收~


## 五、发布阶段


### 提交审核


模板小程序的审核，需要调用对应的 [提交审核](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/submit_audit.html) 接口，同时可以查询审核进度、撤销审核等。


### 发布


调用 [发布](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/release.html) 接口，即可以发布最后一个审核通过的小程序版本（注意不一定是最新，而是最后一个通过的版本）。


然后，在微信中验证下吧~



---



以上，我们就完成了整个模板小程序的开发、体验、提审、发布流程。


但，我们是否忽略了一个最核心的点：我们开发模板小程序，是为了给使用方小程序部署，而不是只看模板小程序。那，使用方的小程序怎么办？


## 六、使用方小程序管理


我们先来梳理下思路：


- 第三方的开发、体验过程，需要用模板小程序来创建出一个可部署的“模板”；
- 如果有使用方想要用这个“模板”，并且希望是自己的小程序，那就得到微信公众平台新申请一个；
- 有了小程序之后，就得托管（授权）给第三方平台；
- 托管成功之后，第三方需要匹配一个合适的模板，并且根据用户需求设置自定义 `ext_json` 字段；
- 设置成功后，第三方就可以通过微信提供的api将模板 [上传](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/commit.html) 到客户小程序；
- 之后，第三方就可以 [提交审核](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/submit_audit.html)、[发布](https://developers.weixin.qq.com/doc/oplatform/Third-party_Platforms/Mini_Programs/code/release.html)，最终完成使用方小程序的上线！



在这个过程中，使用方需要托管（授权）给第三方。

这样，第三方才有权限为使用方选择小程序模板、获取体验版、提审、发布；另外，除了代码管理，还可以设置基础信息、类目管理、成员管理等。


以上，就可以实现一整套的SaaS小程序管理流程~


> 建议：最好通过可视化平台来管理，方便查看及操作，减少出错率，而且通过角色权限管理可以更安全。



## 七、流程总结


- 模板小程序实现
   - 第三方申请微信开放平台
   - 第三方申请第三方平台
   - 第三方申请模板小程序
   - 模板小程序绑定到第三方平台
   - 第三方完成模板小程序开发，注意 `ext.json`
   - 微信扫码预览
   - 提交代码到草稿箱
   - 添加草稿箱到模板库
   - 选择一个模板提交模板小程序审核
   - 审核通过，发布，微信环境访问
- 客户小程序部署
   - 客户申请小程序
   - 客户授权小程序到第三方平台
   - 第三方选择一个模板、自定义用户配置
   - 第三方上传客户小程序代码
   - 第三方提交客户小程序审核
   - 审核通过后，第三方发布小程序
   - 客户微信环境验收

